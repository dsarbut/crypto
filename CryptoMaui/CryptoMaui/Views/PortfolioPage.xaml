<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CryptoMaui.Views.PortfolioPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewModels="clr-namespace:CryptoMaui.ViewModels"
    xmlns:views="clr-namespace:CryptoMaui.Views"
    x:DataType="viewModels:PortfolioViewModel"
    Background="{x:StaticResource Primary}"
    Shell.FlyoutBehavior="Disabled"
    Shell.NavBarIsVisible="False">

    <Grid Margin="16" RowDefinitions="40, 100, *">
        <Border
            Grid.Row="1"
            Stroke="{StaticResource Secondary}"
            StrokeThickness="2">
            <CollectionView HorizontalOptions="Center" VerticalOptions="Center">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <VerticalStackLayout>
                            <Label Text="Crypto" />
                            <Label Text="DCA" />
                            <Label Text="Value" />
                            <Label Text="ROI" />
                        </VerticalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Border>

        <CollectionView
            Grid.Row="2"
            CanReorderItems="False"
            ItemSizingStrategy="MeasureAllItems"
            ItemsSource="{Binding Investments}">
            <CollectionView.Header>
                <Label Margin="10" Text="Investments :" />
            </CollectionView.Header>
            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                    <Label
                        HorizontalOptions="Center"
                        Text="No investments in your portfolio. Add an investment."
                        VerticalOptions="Center" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <VerticalStackLayout
                        Padding="0"
                        x:DataType="viewModels:InvestmentViewModel"
                        Spacing="0">
                        <Border
                            BackgroundColor="{x:StaticResource Secondary}"
                            Stroke="{x:StaticResource Secondary}"
                            StrokeShape="RoundRectangle 10,10,10,10">
                            <Grid
                                Margin="10,0,10,0"
                                HorizontalOptions="Fill"
                                RowDefinitions="*, 10"
                                VerticalOptions="Fill">

                                <CollectionView ItemSizingStrategy="MeasureAllItems" ItemsSource="{Binding CoinDatas}">
                                    <CollectionView.Header>
                                        <Grid
                                            Margin="0,0,0,10"
                                            ColumnDefinitions="*, 100"
                                            HeightRequest="40"
                                            HorizontalOptions="Fill"
                                            RowDefinitions="40"
                                            VerticalOptions="Fill">
                                            <Label
                                                Grid.Row="0"
                                                Grid.Column="0"
                                                FontAttributes="Bold"
                                                FontSize="20"
                                                HorizontalOptions="Start"
                                                Text="{Binding Date, StringFormat='{0:MMMM} {0:yyyy}'}"
                                                VerticalOptions="Center" />

                                            <Label
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                FontAttributes="Bold"
                                                FontSize="20"
                                                HorizontalOptions="End"
                                                Text="{Binding InvestedAmmount, StringFormat='{0} $'}"
                                                VerticalOptions="Center" />
                                        </Grid>
                                    </CollectionView.Header>
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="viewModels:CoinDataViewModel">
                                            <Grid ColumnDefinitions="100, *, *" RowDefinitions="20">
                                                <Label
                                                    Grid.Column="0"
                                                    HorizontalOptions="Start"
                                                    Text="{Binding CoinName}"
                                                    VerticalOptions="Center" />

                                                <Label
                                                    Grid.Column="1"
                                                    HorizontalOptions="End"
                                                    Text="{Binding CoinAmmount, StringFormat='{0:F3}'}"
                                                    VerticalOptions="Center" />

                                                <Label
                                                    Grid.Column="2"
                                                    HorizontalOptions="End"
                                                    Text="{Binding Value, StringFormat='{0:F2} $'}"
                                                    VerticalOptions="Center" />
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>

                                </CollectionView>

                            </Grid>

                        </Border>
                        <BoxView BackgroundColor="Transparent" HeightRequest="10" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Image
            Grid.Row="2"
            Margin="0,0,10,10"
            HeightRequest="60"
            HorizontalOptions="End"
            Opacity="0.9"
            Source="fab_add.png"
            VerticalOptions="End"
            WidthRequest="60">
            <Image.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding AddInvestmentCommand}" />
            </Image.GestureRecognizers>
            <Image.Behaviors>
                <toolkit:AnimationBehavior AnimateOnTap="True">
                    <toolkit:AnimationBehavior.AnimationType>
                        <toolkit:FadeAnimation Opacity="0.5" />
                    </toolkit:AnimationBehavior.AnimationType>
                </toolkit:AnimationBehavior>
            </Image.Behaviors>
        </Image>
    </Grid>
</ContentPage>
